<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de productos</title>

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
    rel="stylesheet"
    crossorigin="anonymous"
  />

  <!-- Bootstrap Icons -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
  />

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap"
    rel="stylesheet"
  />

  <!-- CSS de esta pantalla -->
  <link rel="stylesheet" href="./registroproductos.css" />

  <!-- Header & Footer CSS -->
  <link rel="stylesheet" href="../header-footer/header-footer.css" />

  <!-- Bootstrap JS (bundle) con defer para toasts y componentes -->
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"
  ></script>

  <!-- Header & Footer JS -->
  <script defer src="../header-footer/header-footer.js"></script>

  <!-- Lógica principal de esta pantalla -->
  <script defer src="./registroproductos.js"></script>
</head>

<body style="font-family: 'Montserrat', sans-serif;">
  <!-- Header -->
  <div id="header-container"></div>

  <!-- Contenedor para toasts (Bootstrap 5) -->
  <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3" style="z-index:1080;"></div>

  <!-- Contenido principal -->
  <main class="main-content">
    <div class="form-container container py-4">
      <h4 class="text-center mb-4 fw-bold">REGISTRAR PRODUCTOS</h4>

      <!-- Mensaje informativo -->
      <div class="alert alert-info py-2" role="alert">
        Completa los datos y presiona <strong>PUBLICAR</strong>. Las listas de Marca, Color, Talla y Estado se cargan desde el servidor.
      </div>

      <!-- Formulario -->
      <form id="formularioRegistro" novalidate>
        <div class="mb-3">
          <label for="nombre" class="form-label">Nombre</label>
          <input type="text" class="form-control" id="nombre" name="nombre" required autocomplete="off" />
        </div>

        <div class="mb-3">
          <label for="modelo" class="form-label">Modelo</label>
          <input type="text" class="form-control" id="modelo" name="modelo" required autocomplete="off" />
        </div>

        <div class="mb-3">
          <label for="descripcion" class="form-label">Descripción</label>
          <input type="text" class="form-control" id="descripcion" name="descripcion" autocomplete="off" />
        </div>

        <div class="mb-3">
          <label for="detalle" class="form-label">Detalle</label>
          <input type="text" class="form-control" id="detalle" name="detalle" autocomplete="off" />
        </div>

        <div class="mb-3">
          <label for="precio" class="form-label">Precio</label>
          <input
            type="number"
            class="form-control"
            id="precio"
            name="precio"
            placeholder="$"
            min="0"
            step="0.01"
            required
            inputmode="decimal"
          />
        </div>

        <div class="row g-3 mb-3">
          <div class="col-12 col-md-4">
            <label for="color" class="form-label">Color</label>
            <select id="color" name="color" class="form-select" required>
              <option value="">Color</option>
            </select>
          </div>

          <div class="col-12 col-md-4">
            <label for="talla" class="form-label">Talla</label>
            <select id="talla" name="talla" class="form-select" required>
              <option value="">Talla</option>
            </select>
          </div>

          <div class="col-12 col-md-4">
            <label for="estado" class="form-label">Estado</label>
            <select id="estado" name="estado" class="form-select" required>
              <option value="">Estado</option>
            </select>
          </div>
        </div>

        <div class="mb-3">
          <label for="marca" class="form-label">Marca</label>
          <select id="marca" name="marca" class="form-select" required>
            <option value="">Marca</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="imagen" class="form-label">Imagen (opcional)</label>
          <input
            type="file"
            class="form-control"
            id="imagen"
            name="imagen"
            accept="image/*"
            aria-label="Seleccionar imagen"
          />
          <small class="text-muted">La imagen se sube automáticamente después de crear el producto.</small>
        </div>

        <button type="submit" class="btn btn-primary w-100" id="btn-publicar">
          PUBLICAR
        </button>
      </form>

      <!-- Contenedor opcional para mostrar el producto recién creado -->
      <div id="producto" class="mt-4"></div>
    </div>
  </main>

  <!-- Footer -->
  <div id="footer-container"></div>

  <!-- (Opcional) EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <!-- Inicialización segura del header/footer + sesión -->
  <script>
    (function initLayout() {
      function cargarSesionLuego() {
        const script = document.createElement("script");
        script.src = "/Login/session.js";
        script.onload = () => {
          if (typeof manejarSesion === "function") manejarSesion();
        };
        document.body.appendChild(script);
      }

      if (typeof cargarHeader === "function") {
        try {
          cargarHeader().then(cargarSesionLuego).catch(cargarSesionLuego);
        } catch (err) {
          console.error("Error al cargar header:", err);
          cargarSesionLuego();
        }
      } else {
        console.warn("cargarHeader no está definida.");
        cargarSesionLuego();
      }

      if (typeof cargarFooter === "function") {
        try {
          cargarFooter();
        } catch (err) {
          console.error("Error al cargar footer:", err);
        }
      } else {
        console.warn("cargarFooter no está definida.");
      }
    })();
  </script>
</body>
</html>
